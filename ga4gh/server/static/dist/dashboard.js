"use strict";$(window).on("load",function(){makeRequest("datasets/search",{}).then(function(a){const b=JSON.parse(a),c=b.results.datasets;let d=document.getElementById("dropdown-menu");for(let b=0;b<c.length;b++)finalDatasetId.includes(c[b].id)||(finalDatasetId.push(c[b].id),finalDatasetName.push(c[b].name));for(let b=0;b<finalDatasetId.length;b++)d.innerHTML+="<a class=\"dropdown-item\" id=\"refresh\" href=\"javascript:void(0)\" onclick=\"refreshDataset("+b+")\">"+finalDatasetName[b]+"</a>";null==getCookie("datasetId")||-1==finalDatasetId.indexOf(getCookie("datasetId"))?(datasetId=finalDatasetId[0],setCookie("datasetId",datasetId),$("#dropdownMenuLink").html("<i class=\"fas fa-database\"></i> "+finalDatasetName[0])):(datasetId=getCookie("datasetId"),$("#dropdownMenuLink").html("<i class=\"fas fa-database\"></i> "+finalDatasetName[finalDatasetId.indexOf(datasetId)]));let e=new dashboard;e.initialize()},function(){alertBuilder("No data currently available. Please contact a system administrator for assistance.")})});function refreshDataset(a){datasetId=finalDatasetId[a],document.getElementById("warningMsg").style.display="none",setCookie("datasetId",datasetId),$("#dropdownMenuLink").html("<i class=\"fas fa-database\"></i> "+finalDatasetName[finalDatasetId.indexOf(getCookie("datasetId"))]);let b=new dashboard;b.initialize()}function dashboard(){function a(){document.getElementById("responseToTreatment").innerHTML="<div class=\"loader_bar\"></div>",document.getElementById("therapeuticToResponses").innerHTML="<div class=\"loader_bar\"></div>",document.getElementById("cancerTypes").innerHTML="<div class=\"loader_bar\"></div>",document.getElementById("drugScatter").innerHTML="<div class=\"loader_bar\"></div>",document.getElementById("hospitals").innerHTML="<div class=\"loader_bar\"></div>",document.getElementById("queryStatus").innerHTML="<div class=\"loader_bar\"></div>",document.getElementById("timelineSamples").innerHTML="<div class=\"loader_bar\"></div>"}function b(a){document.getElementById(a).innerHTML="<p class='noPermission'>No data available</p>"}function c(a,b){for(var c={},d=[],e=0;e<a.length;e++)c={},c.name=a[e],c.y=b[e],d.push(c);return d}function d(){makeRequest("enrollments/search",{datasetId:datasetId}).then(function(a){var c,d=JSON.parse(a),f=d.results.enrollments,g=[],j={"Known Peers":d.status["Known peers"],"Queried Peers":d.status["Queried peers"],"Successful Communications":d.status["Successful communications"]};if(h("queryStatus","bar","Server status",j),c=groupBy(f,"treatingCentreName"),0==Object.keys(c).length?b("hospitals"):h("hospitals","bar","Hospital distribution",c),null==f[0].enrollmentApprovalDate)document.getElementById("timelineSamples").innerHTML="<p class='noPermission'>No data available</p>";else{for(var k=0;k<f.length;k++)if(f[k].enrollmentApprovalDate){let a=new Date(f[k].enrollmentApprovalDate);f[k].enrollmentApprovalDate=a.getFullYear()}g=groupBy(f,"enrollmentApprovalDate");var l=Object.keys(g),m=Object.values(g),n=[0];m.forEach(function(a,b){var c=n[b]+a;n.push(c)}),n.shift(),e(m,l,n)}},function(){b("hospitals"),b("timelineSamples"),b("queryStatus")})}function e(a,b,c){Highcharts.chart("timelineSamples",{chart:{type:"area",zoomType:"xy"},title:{text:"Samples received by years"},credits:{enabled:!1},exporting:{enabled:!1},xAxis:{categories:b,tickmarkPlacement:"on",title:{enabled:!1}},yAxis:{title:{text:""},labels:{formatter:function(){return this.value}}},tooltip:{split:!0,valueSuffix:""},plotOptions:{area:{stacking:"normal",lineColor:"#666666",lineWidth:1,marker:{lineWidth:1,lineColor:"#666666"}}},series:[{type:"column",name:"new sample",data:a},{type:"line",name:"Cumulative samples",data:c}]})}function f(a){let c={},d=[];searchRequest("diagnoses",["systematicTherapyAgentName","startDate","stopDate"],datasetId,{field:"cancerType",operator:"==",value:a},"chemotherapies").then(function(e){if(0==e.length)b("drugScatter");else{for(let a=0;a<e.length;a++){let b=e[a],d=new Date(b.startDate),f=new Date(b.stopDate),g=j((f-d)/86400000),h=b.systematicTherapyAgentName;c[h]?c[h].push(g):(c[h]=[],c[h].push(g))}let b=Object.keys(c);for(let a=0;a<b.length;a++)for(let e,f=0;f<c[b[a]].length;f++)e=[],e.push(a),e.push(c[b[a]][f]),d.push(e);Highcharts.chart("drugScatter",{chart:{renderTo:"drugScatter",type:"scatter",zoomType:"xy"},title:{text:"Time of drug treatment for "+a},credits:{enabled:!1},exporting:{enabled:!1},xAxis:{categories:b},yAxis:{title:{text:"days"}},tooltip:{formatter:function(){return""+this.x+", "+this.y+" days"}},plotOptions:{scatter:{marker:{symbol:"circle",radius:5,states:{hover:{enabled:!0,lineColor:"rgb(100,100,100)"}}},states:{hover:{marker:{enabled:!1}}}}},series:[{name:"Drugs",color:"rgba(223, 83, 83, .75)",data:d}]})}})}function g(a,d,e,g){if(g==null)b(a);else{var h=Object.keys(g),i=Object.values(g),j=c(h,i);Highcharts.chart(a,{chart:{type:d},credits:{enabled:!1},exporting:{enabled:!1},title:{text:e},xAxis:{type:"category"},legend:{enabled:!1},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0}}},series:[{name:"count",colorByPoint:!0,data:j,cursor:"pointer",point:{events:{click:function(){f(this.name)}}}}]})}}function h(a,d,e,f){if(f==null)b(a);else{var g=Object.keys(f),h=Object.values(f),i=c(g,h);Highcharts.chart(a,{chart:{type:d},credits:{enabled:!1},exporting:{enabled:!1},title:{text:e},xAxis:{type:"category"},legend:{enabled:!1},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0}}},series:[{name:"count",colorByPoint:!0,data:i}]})}}var j=Math.floor;this.initialize=function(){alertCloser(),a(),d(),countRequest("treatments",["responseToTreatment","therapeuticModality"],datasetId).then(function(a){h("responseToTreatment","bar","Response to treatments",a.responseToTreatment),h("therapeuticToResponses","bar","Therapeutic Types",a.therapeuticModality)}),countRequest("diagnoses",["cancerType"],datasetId).then(function(a){if(g("cancerTypes","pie","cancer types and corresponding treatment drugs",a.cancerType),a.cancerType){let b=Object.keys(a.cancerType);var c=b[j(Math.random()*b.length)];f(c)}else b("drugScatter")})}}